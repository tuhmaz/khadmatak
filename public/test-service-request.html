<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ุทูุจ ุงูุฎุฏูุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">ุงุฎุชุจุงุฑ ูุธุงู ุทูุจ ุงูุฎุฏูุฉ ุงููุญุณู</h1>
        
        <!-- Login Section -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ุชุณุฌูู ุนููู ุฌุฏูุฏ / ุชุณุฌูู ุงูุฏุฎูู</h2>
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <h3 class="font-medium mb-2">ุชุณุฌูู ุนููู ุฌุฏูุฏ</h3>
                    <input type="email" id="register_email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" class="w-full p-2 border rounded mb-2" value="testcustomer@test.com">
                    <input type="password" id="register_password" placeholder="ูููุฉ ุงููุฑูุฑ" class="w-full p-2 border rounded mb-2" value="TestPass123!">
                    <input type="text" id="register_name" placeholder="ุงูุงุณู" class="w-full p-2 border rounded mb-2" value="ุนููู ุงุฎุชุจุงุฑ">
                    <input type="tel" id="register_phone" placeholder="ุฑูู ุงููุงุชู" class="w-full p-2 border rounded mb-2" value="0791234580">
                    <button onclick="registerCustomer()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 w-full">
                        ุชุณุฌูู ุนููู
                    </button>
                </div>
                <div>
                    <h3 class="font-medium mb-2">ุชุณุฌูู ุงูุฏุฎูู</h3>
                    <input type="email" id="login_email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" class="w-full p-2 border rounded mb-2" value="testcustomer@test.com">
                    <input type="password" id="login_password" placeholder="ูููุฉ ุงููุฑูุฑ" class="w-full p-2 border rounded mb-2" value="TestPass123!">
                    <button onclick="loginUser()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 w-full">
                        ุชุณุฌูู ุงูุฏุฎูู
                    </button>
                </div>
            </div>
        </div>

        <!-- Service Request Form -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ูููุฐุฌ ุทูุจ ุงูุฎุฏูุฉ</h2>
            <form id="serviceForm" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block font-medium mb-1">ูุฆุฉ ุงูุฎุฏูุฉ *</label>
                        <select id="category_id" class="w-full p-2 border rounded">
                            <option value="">ุงุฎุชุฑ ูุฆุฉ ุงูุฎุฏูุฉ</option>
                            <option value="1">ุณุจุงูุฉ</option>
                            <option value="2">ููุฑุจุงุก</option>
                            <option value="3">ุชูุธูู</option>
                            <option value="4">ุตูุงูุฉ ุนุงูุฉ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block font-medium mb-1">ุนููุงู ุงูุทูุจ *</label>
                        <input type="text" id="title" class="w-full p-2 border rounded" placeholder="ูุซุงู: ุฅุตูุงุญ ุตูุจูุฑ ุงููุทุจุฎ">
                    </div>
                </div>

                <div>
                    <label class="block font-medium mb-1">ูุตู ุงููุทููุจ *</label>
                    <textarea id="description" class="w-full p-2 border rounded" rows="3" placeholder="ุงุดุฑุญ ุชูุงุตูู ุงููุดููุฉ ูุงูุฎุฏูุฉ ุงููุทููุจุฉ"></textarea>
                </div>

                <div>
                    <label class="block font-medium mb-1">ุนููุงู ุงูููุงู *</label>
                    <input type="text" id="location_address" class="w-full p-2 border rounded" placeholder="ุงูุญูุ ุงูุดุงุฑุนุ ุฑูู ุงูุจูุงุก">
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block font-medium mb-1">ุงูุชุงุฑูุฎ ุงูููุถู</label>
                        <input type="date" id="preferred_date" class="w-full p-2 border rounded">
                    </div>
                    <div>
                        <label class="block font-medium mb-1">ููุช ุงูุจุฏุงูุฉ</label>
                        <input type="time" id="preferred_time_start" class="w-full p-2 border rounded">
                    </div>
                    <div>
                        <label class="block font-medium mb-1">ููุช ุงูููุงูุฉ</label>
                        <input type="time" id="preferred_time_end" class="w-full p-2 border rounded">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block font-medium mb-1">ุงูููุฒุงููุฉ ุงูุฏููุง (ุฏ.ุฃ)</label>
                        <input type="number" id="budget_min" class="w-full p-2 border rounded" min="0" step="0.5">
                    </div>
                    <div>
                        <label class="block font-medium mb-1">ุงูููุฒุงููุฉ ุงูุนููุง (ุฏ.ุฃ)</label>
                        <input type="number" id="budget_max" class="w-full p-2 border rounded" min="0" step="0.5">
                    </div>
                </div>

                <div>
                    <label class="flex items-center">
                        <input type="checkbox" id="emergency" class="ml-2">
                        <span>ุญุงูุฉ ุทูุงุฑุฆ</span>
                    </label>
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">
                        ุฅุฑุณุงู ุงูุทูุจ
                    </button>
                    <button type="button" onclick="testValidation()" class="bg-orange-600 text-white px-6 py-2 rounded hover:bg-orange-700">
                        ุงุฎุชุจุงุฑ ุงูุชุญูู (ูุงุฑุบ)
                    </button>
                    <button type="button" onclick="testInvalidData()" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700">
                        ุงุฎุชุจุงุฑ ุจูุงูุงุช ุฎุงุทุฆุฉ
                    </button>
                </div>
            </form>
        </div>

        <!-- Test Cases -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ุญุงูุงุช ุงุฎุชุจุงุฑ ุณุฑูุนุฉ</h2>
            <div class="flex gap-2 flex-wrap">
                <button onclick="fillValidData()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    ููุก ุจูุงูุงุช ุตุญูุญุฉ
                </button>
                <button onclick="fillMissingTitle()" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">
                    ุนููุงู ููููุฏ
                </button>
                <button onclick="fillShortDescription()" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">
                    ูุตู ูุตูุฑ
                </button>
                <button onclick="fillInvalidBudget()" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">
                    ููุฒุงููุฉ ุฎุงุทุฆุฉ
                </button>
                <button onclick="fillPastDate()" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">
                    ุชุงุฑูุฎ ูู ุงููุงุถู
                </button>
            </div>
        </div>

        <!-- Results -->
        <div id="results" class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">ุงููุชุงุฆุฌ ูุงูุฑุณุงุฆู</h2>
            <pre id="output" class="bg-gray-100 p-4 rounded text-sm overflow-auto max-h-96"></pre>
        </div>
    </div>

    <script>
        let currentToken = null;

        function log(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString('ar-JO');
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('output').textContent = '';
        }

        // Configure axios
        axios.defaults.withCredentials = true;
        axios.interceptors.request.use((config) => {
            if (currentToken) {
                config.headers.Authorization = `Bearer ${currentToken}`;
            }
            return config;
        });

        async function registerCustomer() {
            const data = {
                email: document.getElementById('register_email').value,
                password: document.getElementById('register_password').value,
                name: document.getElementById('register_name').value,
                phone: document.getElementById('register_phone').value,
                user_type: 'customer',
                city: 'ุนููุงู'
            };

            try {
                const response = await axios.post('/api/register', data);
                if (response.data.success) {
                    currentToken = response.data.token;
                    log('โ ุชู ุชุณุฌูู ุงูุนููู ุจูุฌุงุญ');
                    log(`ID: ${response.data.user.id}, Type: ${response.data.user.user_type}`);
                }
            } catch (error) {
                log('โ ุฎุทุฃ ูู ุงูุชุณุฌูู: ' + (error.response?.data?.error || error.message));
            }
        }

        async function loginUser() {
            const data = {
                email: document.getElementById('login_email').value,
                password: document.getElementById('login_password').value
            };

            try {
                const response = await axios.post('/api/login', data);
                if (response.data.success) {
                    currentToken = response.data.token;
                    log('โ ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ');
                    log(`Name: ${response.data.user.name}, Type: ${response.data.user.user_type}`);
                }
            } catch (error) {
                log('โ ุฎุทุฃ ูู ุชุณุฌูู ุงูุฏุฎูู: ' + (error.response?.data?.error || error.message));
            }
        }

        async function submitServiceRequest() {
            if (!currentToken) {
                log('โ ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู');
                return;
            }

            const data = {
                category_id: parseInt(document.getElementById('category_id').value) || null,
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                location_address: document.getElementById('location_address').value,
                preferred_date: document.getElementById('preferred_date').value || null,
                preferred_time_start: document.getElementById('preferred_time_start').value || null,
                preferred_time_end: document.getElementById('preferred_time_end').value || null,
                budget_min: parseFloat(document.getElementById('budget_min').value) || null,
                budget_max: parseFloat(document.getElementById('budget_max').value) || null,
                emergency: document.getElementById('emergency').checked,
                customer_phone: '0791234580'
            };

            log('๐ ุฅุฑุณุงู ุทูุจ ุงูุฎุฏูุฉ...');
            log('ุงูุจูุงูุงุช ุงููุฑุณูุฉ: ' + JSON.stringify(data, null, 2));

            try {
                const response = await axios.post('/api/request', data);
                if (response.data.success) {
                    log('โ ุชู ุฅูุดุงุก ุทูุจ ุงูุฎุฏูุฉ ุจูุฌุงุญ!');
                    log('ุฑุณุงูุฉ ุงููุฌุงุญ: ' + response.data.message);
                    if (response.data.data) {
                        log('ุชูุงุตูู ุงูุทูุจ: ' + JSON.stringify(response.data.data, null, 2));
                    }
                }
            } catch (error) {
                log('โ ูุดู ุฅูุดุงุก ุทูุจ ุงูุฎุฏูุฉ:');
                log('Status: ' + error.response?.status);
                log('ุฎุทุฃ: ' + (error.response?.data?.error || error.message));
                if (error.response?.data?.missing_fields) {
                    log('ุงูุญููู ุงูููููุฏุฉ: ' + error.response.data.missing_fields.join('ุ '));
                }
            }
        }

        // Test functions
        function fillValidData() {
            document.getElementById('category_id').value = '1';
            document.getElementById('title').value = 'ุฅุตูุงุญ ุตูุจูุฑ ุงููุทุจุฎ ุงููุชุณุฑุจ';
            document.getElementById('description').value = 'ููุฌุฏ ุชุณุฑุจ ูู ุตูุจูุฑ ุงููุทุจุฎ ููุญุชุงุฌ ูุฅุตูุงุญ ุนุงุฌู. ุงูููุงู ุชุชุณุฑุจ ูู ุงูููุจุถ ุงูุนููู';
            document.getElementById('location_address').value = 'ุงูุฌุจููุฉุ ุดุงุฑุน ุงููููุฉ ุฑุงููุงุ ุนูุงุฑุฉ 25ุ ุงูุทุงุจู ุงูุซุงูุซ';
            document.getElementById('budget_min').value = '20';
            document.getElementById('budget_max').value = '50';
            
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('preferred_date').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('preferred_time_start').value = '09:00';
            document.getElementById('preferred_time_end').value = '12:00';
            
            log('ุชู ููุก ุงูุจูุงูุงุช ุงูุตุญูุญุฉ');
        }

        function fillMissingTitle() {
            fillValidData();
            document.getElementById('title').value = '';
            log('ุชู ุญุฐู ุงูุนููุงู ูุงุฎุชุจุงุฑ ุงูุชุญูู');
        }

        function fillShortDescription() {
            fillValidData();
            document.getElementById('description').value = 'ูุตูุฑ';
            log('ุชู ูุถุน ูุตู ูุตูุฑ ูุงุฎุชุจุงุฑ ุงูุชุญูู');
        }

        function fillInvalidBudget() {
            fillValidData();
            document.getElementById('budget_min').value = '100';
            document.getElementById('budget_max').value = '50';
            log('ุชู ูุถุน ููุฒุงููุฉ ุฎุงุทุฆุฉ ูุงุฎุชุจุงุฑ ุงูุชุญูู');
        }

        function fillPastDate() {
            fillValidData();
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            document.getElementById('preferred_date').value = yesterday.toISOString().split('T')[0];
            log('ุชู ูุถุน ุชุงุฑูุฎ ูู ุงููุงุถู ูุงุฎุชุจุงุฑ ุงูุชุญูู');
        }

        function testValidation() {
            // Clear all fields to test validation
            document.getElementById('serviceForm').reset();
            log('ุชู ูุณุญ ุงููููุฐุฌ ูุงุฎุชุจุงุฑ ุงูุชุญูู ูู ุงูุญููู ุงููุงุฑุบุฉ');
        }

        function testInvalidData() {
            document.getElementById('category_id').value = '999'; // Invalid category
            document.getElementById('title').value = 'ูุต'; // Too short
            document.getElementById('description').value = 'ูุตูุฑ'; // Too short
            document.getElementById('location_address').value = 'ูุต'; // Too short
            document.getElementById('preferred_date').value = '2020-01-01'; // Past date
            document.getElementById('preferred_time_start').value = '25:00'; // Invalid time
            document.getElementById('budget_min').value = '100';
            document.getElementById('budget_max').value = '50'; // Invalid budget range
            log('ุชู ููุก ุจูุงูุงุช ุฎุงุทุฆุฉ ูุงุฎุชุจุงุฑ ุงูุชุญูู');
        }

        // Form submission
        document.getElementById('serviceForm').addEventListener('submit', (e) => {
            e.preventDefault();
            submitServiceRequest();
        });

        // Initial log
        log('ุชู ุชุญููู ุตูุญุฉ ุงุฎุชุจุงุฑ ุทูุจ ุงูุฎุฏูุฉ');
        log('ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู ุซู ุชุฌุฑุจุฉ ุฅุฑุณุงู ุทูุจ ุฎุฏูุฉ');
    </script>
</body>
</html>